<?php

/**
 * @file
 * A test gateway to be used for testing the sms framework
 */
use Drupal\sms\Message\SmsMessageInterface;

/**
 * Implements hook_sms_incoming().
 */
function sms_test_gateway_sms_incoming($op, SmsMessageInterface $sms, array $options) {
  // Save incoming result for later retrieval.
  $key = 'sms_test_gateway_get_incoming' . $op;
  $result = &drupal_static($key);

  if (!is_null($sms->getRecipients()) && !is_null($sms->getMessage())) {
    $result['number'] = $sms->getRecipients()[0];
    $result['message'] = $sms->getMessage();
    $result['options'] = $options;
    \Drupal::state()->set($key, $result);
  }
}

function sms_test_gateway_get_incoming($op, $reset = FALSE) {
  $key = __FUNCTION__ . $op;
  $result = &drupal_static($key);

  if (!isset($result)) {
    $result = \Drupal::state()->get($key, array());
  }

  if ($reset) {
    \Drupal::state()->delete($key);
    drupal_static_reset($key);
  }
  return $result;
}
